<div class="ui action input send">
  <form class="form">
    <input type="text" class="input" placeholder="Type your message here...">
    <button class="ui button">Send message</button>
  </form>
</div>

<%
__this.Defer(function(){
  //disallow form redirect
  $("form").submit(function( event ) {
    event.preventDefault();
  });

  __this.first().find('button').click(function(){
    var message = __this.first().find('input').val();
      if(message!==""){
        phoxy.ApiRequest(['thread/add_message', __this.t_id, __this.username, message], function()
        {
          __this.first().find('input').val('');
          //send event
          var event_data = {thread_id:__this.t_id,message:message, message_from:__this.username};
          for(m in __this.members)
          {
            phoxy.ApiRequest(['event/add_event', __this.members[m].username, event_data, 'thread'], function()
            {

            });
          }


        });
      }
  });
});
%>
